# 前端需求（uni-app）——涵盖全部已提供 API 的用法、输入与输出

统一要求：
- 请求默认携带 `Authorization: Bearer <token>`（注册/登录除外）；time 使用 ISO8601。
- 接口错误统一处理：401 退登重登录，其他错误 toast/弹窗；列表有加载/空态/错误态。
- http 层统一封装，自动注入 token、处理重试与错误码。

## 1. 认证与用户（/user）
### 注册 POST /user/register
- 请求示例
```json
{ "time":"2025-11-05T10:00:00Z", "token":null, "username":"alice", "password":"Pass#1234", "email":"alice@example.com" }
```
- 响应示例
```json
{ "status":"success", "user_id":"uuid-string", "message":"注册成功" }
```
### 登录 POST /user/login
- 请求示例
```json
{ "time":"2025-11-05T10:05:00Z", "token":null, "email":"alice@example.com", "password":"Pass#1234" }
```
- 响应示例
```json
{ "status":"success", "user_id":"uuid-string", "token":"jwt-token", "message":"登录成功" }
```
### 登出 POST /user/logout
- 请求示例
```json
{ "time":"2025-11-05T10:10:00Z", "token":"jwt-token" }
```
- 响应示例
```json
{ "status":"success", "message":"登出成功" }
```
### 个人资料 GET/PUT/DELETE /user/profile/{user_id}
- GET 响应示例
```json
{ "status":"success", "data":{ "id":"uuid", "email":"alice@example.com", "full_name":"Alice", "display_name":"Alice", "created_at":"2025-11-05T10:00:00Z" } }
```
- PUT 请求示例
```json
{ "time":"2025-11-05T10:15:00Z", "token":"jwt-token", "full_name":"Alice Johnson", "display_name":"AJ" }
```
- PUT 响应示例
```json
{ "status":"success", "data":{ "id":"uuid", "full_name":"Alice Johnson", "display_name":"AJ" }, "message":"用户信息更新成功" }
```
- DELETE 请求示例：`{ "time":"...", "token":"jwt-token" }`；响应同上格式，status success。

前端页面：登录/注册页；个人中心（查看、编辑、删除账号）。

## 2. 工作空间（/workspaces）
- 创建 POST /workspaces
```json
{ "time":"2025-11-05T11:00:00Z", "token":"jwt-token", "name":"Project Alpha", "description":"Workspace for Alpha" }
```
响应
```json
{ "status":"success", "data":{ "id":"uuid", "name":"Project Alpha", "owner_user_id":"uuid", "created_at":"..." }, "message":"创建成功" }
```
- 列表 GET /workspaces → `{ "status":"success", "data":[{...}], "count":1 }`
- 详情 GET /workspaces/{id} → `{ "status":"success", "data":{...} }`
- 更新 PUT /workspaces/{id} 请求 `{ "time":"...", "token":"jwt", "name":"Beta" }` → 响应 status success
- 删除 DELETE /workspaces/{id} 请求 `{ "time":"...", "token":"jwt" }` → 响应 `{ "status":"success","message":"删除成功" }`

前端页面：工作空间列表/切换、创建/编辑弹窗、删除确认。

## 3. 项目（/projects）
- 创建 POST /projects
```json
{ "workspace_id":"ws-uuid", "owner_id":"user-uuid", "title":"Website Redesign", "description":"Phase 1", "start_date":"2025-11-05", "due_date":"2025-12-01" }
```
响应
```json
{ "status":"success", "data":{ "id":"uuid", "workspace_id":"ws-uuid", "title":"Website Redesign", "description":"Phase 1" }, "message":"创建成功" }
```
- 列表 GET /projects?workspace_id=ws → `{ "status":"success","data":[{...}],"count":1 }`
- 详情 GET /projects/{id} → `{ "status":"success","data":{...} }`
- 更新 PUT /projects/{id} 请求 `{ "title":"Website Redesign Phase 1" }` → 响应 status success
- 删除 DELETE /projects/{id} → `{ "status":"success","message":"删除成功" }`

前端页面：项目列表（按 workspace 过滤）、详情、创建/编辑表单、删除确认。

## 4. 任务（/tasks）
- 创建 POST /tasks
```json
{ "workspace_id":"ws-uuid", "creator_id":"user-uuid", "title":"Design homepage", "project_id":"proj-uuid", "description":"Wireframes", "assignee_id":"user-uuid", "priority":"high", "estimated_minutes":240, "due_at":"2025-11-15T10:00:00Z" }
```
响应
```json
{ "status":"success", "data":{ "id":"uuid", "title":"Design homepage", "status":"backlog", "priority":"high" }, "message":"创建成功" }
```
- 列表 GET /tasks?workspace_id=ws&project_id=proj → `{ "status":"success","data":[{...}],"count":1 }`
- 详情 GET /tasks/{id} → `{ "status":"success","data":{...} }`
- 更新 PUT /tasks/{id} 请求（示例）
```json
{ "title":"Design homepage v2", "status":"in_progress", "assignee_id":"user-uuid" }
```
响应：`{ "status":"success","data":{...},"message":"更新成功" }`
- 删除 DELETE /tasks/{id} → `{ "status":"success","message":"删除成功" }`

前端页面：任务列表/筛选（workspace/project/状态/优先级）、详情、编辑、删除；状态/指派更新。

## 5. 标签（/tags）
- 创建 POST /tags
```json
{ "workspace_id":"ws-uuid", "user_id":"user-uuid", "name":"Frontend", "color":"#FF0000" }
```
响应：`{ "status":"success","data":{ "id":"tag-uuid","name":"Frontend" },"message":"创建成功" }`
- 列表 GET /tags?workspace_id=ws → `{ "status":"success","data":[{...}],"count":1 }`
- 关联 POST /tags/attach `{ "task_id":"task-uuid","tag_id":"tag-uuid" }` → `{ "status":"success","message":"标签已关联" }`
- 解绑 POST /tags/detach `{ "task_id":"task-uuid","tag_id":"tag-uuid" }` → `{ "status":"success","message":"标签已移除" }`

前端：标签管理（创建/列表）；任务详情中添加/移除标签。标签更新/删除后端未提供，前端可不展示或灰态占位。

## 6. 评论（/comments）
- 创建 POST /comments
```json
{ "resource_type":"task", "resource_id":"task-uuid", "user_id":"user-uuid", "content":"Looks good!", "reply_to_comment_id":null }
```
响应：`{ "status":"success","data":{ "id":"comment-uuid","content":"Looks good!" },"message":"创建成功" }`
- 列表 GET /comments?resource_type=task&resource_id=task-uuid → `{ "status":"success","data":[{...}],"count":1 }`
- 删除 DELETE /comments/{id} → `{ "status":"success","message":"删除成功" }`

前端：评论区（任务/项目），发布、回复、删除；编辑占位（后端未提供）。

## 7. 附件（/attachments）
- 创建 POST /attachments
```json
{ "owner_id":"user-uuid", "attached_to_type":"task", "attached_to_id":"task-uuid", "file_name":"design.png", "file_size":102400, "content_type":"image/png", "storage_key":"uploads/design.png", "attachment_type":"file", "metadata":{} }
```
响应：`{ "status":"success","data":{ "id":"att-uuid","file_name":"design.png" },"message":"创建成功" }`
- 列表 GET /attachments?attached_to_type=task&attached_to_id=task-uuid → `{ "status":"success","data":[{...}],"count":1 }`
- 删除 DELETE /attachments/{id} → `{ "status":"success","message":"删除成功" }`

前端：附件列表；上传流程需先获得 storage_key（自行上传到存储），再调用创建接口；删除按钮。

## 8. 通知（/notifications）
- 创建 POST /notifications
```json
{ "user_id":"user-uuid", "level":"info", "title":"Task assigned", "body":"You have a new task", "data":{}, "channel":"in_app" }
```
响应：`{ "status":"success","data":{ "id":"notif-uuid","title":"Task assigned","is_read":false },"message":"创建成功" }`
- 列表 GET /notifications?user_id=user-uuid&unread_only=false → `{ "status":"success","data":[{...}],"count":1 }`
- 标记已读 POST /notifications/{id}/read → `{ "status":"success","message":"已标记为已读" }`

前端：通知中心；未读筛选；标记已读；删除占位（后端未提供）。

## 9. 搜索（/search）
- GET /search?workspace_id=ws-uuid&q=home
响应示例
```json
{
  "status":"success",
  "data":{
    "tasks":[{ "id":"task-uuid", "title":"Design homepage", "description":"...", "project_id":"proj-uuid", "status":"in_progress" }],
    "projects":[{ "id":"proj-uuid", "title":"Website Redesign", "description":"...", "workspace_id":"ws-uuid" }]
  }
}
```

前端：全局搜索栏；结果分组展示任务/项目；支持跳转详情，加载/空态。

## 10. AI 功能（/ai）
### 10.1 任务分解 POST /ai/decompose
- 请求示例
```json
{ "goal":"两周内完成官网改版", "user_id":"user-uuid", "workspace_id":"ws-uuid" }
```
- 响应示例
```json
{
  "success": true,
  "data": {
    "main_goal": "两周内完成官网改版",
    "tasks": [
      { "title":"规划信息架构","description":"整理导航与页面层次","estimated_time":120,"estimated_time_unit":"minute","priority":"high","subtasks":[] }
    ]
  },
  "message": "任务分解成功"
}
```
### 10.2 任务建议 POST /ai/suggestions/{task_id}
- 请求示例：path task_id，body `{ "user_id":"user-uuid" }`
- 响应示例
```json
{
  "success": true,
  "data": {
    "task_title": "设计首页",
    "suggestions": [
      { "title":"明确内容优先级","description":"先列关键区块","steps":["收集需求","列信息架构","确认排版"] }
    ],
    "resources": [ { "title":"设计规范示例","url":"https://example.com" } ],
    "tips": ["先低保真草图", "与开发确认栅格"]
  },
  "message": "建议获取成功"
}
```
### 10.3 对话 POST /ai/chat (/ai/chat-stream)
- 请求示例：`{ "message":"怎么规划首页？", "user_id":"user-uuid" }`
- 响应示例：`{ "success":true, "data":{ "response":"..." }, "message":"对话成功" }`

## 11. 待后端补齐但前端需占位
- 组织与成员管理、子任务/依赖/活动日志、自定义字段、标签更新/删除、通知删除、提醒(reminders)、文件直传、模板/时间追踪/集成/审计等。前端对应入口灰态或文案提示“即将上线”，避免调用不存在的接口。

## 12. 页面与接口映射
- 登录/注册 → /user/login, /user/register
- 个人中心 → /user/profile/{id} (GET/PUT/DELETE)
- 工作空间列表/管理 → /workspaces
- 项目列表/详情/编辑 → /projects, /projects/{id}
- 任务列表/详情/编辑 → /tasks, /tasks/{id}; 标签 attach/detach；评论列表/发布/删除；附件列表/创建/删除
- 搜索页 → /search
- 通知中心 → /notifications, /notifications/{id}/read
- AI 功能 → /ai/decompose, /ai/suggestions/{task_id}, /ai/chat(/chat-stream)
